<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clubzila Integration Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="gradient-bg text-white py-6">
            <div class="container mx-auto px-4">
                <h1 class="text-3xl font-bold text-center">Clubzila Integration Demo</h1>
                <p class="text-center mt-2 opacity-90">Test Clubzila authentication and subscription flows</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Authentication Section -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">üîê Authentication</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="phoneNumber" placeholder="0712345678" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">OTP (Optional)</label>
                            <input type="text" id="otp" placeholder="123456" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="requestOtp()" 
                                    class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                                Request OTP
                            </button>
                            <button onclick="authenticate()" 
                                    class="flex-1 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors">
                                Authenticate
                            </button>
                        </div>
                    </div>
                    
                    <div id="authResult" class="mt-4 p-3 rounded-md hidden"></div>
                </div>

                <!-- Subscription Section -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">üí≥ Subscription Management</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">User ID</label>
                            <input type="text" id="userId" placeholder="user_123" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Creator ID</label>
                            <input type="text" id="creatorId" placeholder="creator_456" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="subPhoneNumber" placeholder="0712345678" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="checkSubscription()" 
                                    class="flex-1 bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 transition-colors">
                                Check Subscription
                            </button>
                            <button onclick="processPayment()" 
                                    class="flex-1 bg-orange-600 text-white py-2 px-4 rounded-md hover:bg-orange-700 transition-colors">
                                Process Payment
                            </button>
                        </div>
                        
                        <div class="flex items-center">
                            <input type="checkbox" id="autoPay" class="mr-2">
                            <label for="autoPay" class="text-sm text-gray-700">Auto-pay for subscription</label>
                        </div>
                        
                        <button onclick="handleSubscription()" 
                                class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition-colors">
                            Handle Complete Subscription Flow
                        </button>
                    </div>
                    
                    <div id="subResult" class="mt-4 p-3 rounded-md hidden"></div>
                </div>
            </div>

            <!-- API Status -->
            <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">üîß API Status</h2>
                <div class="grid md:grid-cols-3 gap-4">
                    <button onclick="testIntegration()" 
                            class="bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 transition-colors">
                        Test Clubzila Integration
                    </button>
                    <button onclick="getUser()" 
                            class="bg-teal-600 text-white py-2 px-4 rounded-md hover:bg-teal-700 transition-colors">
                        Get User Info
                    </button>
                    <button onclick="getCreator()" 
                            class="bg-pink-600 text-white py-2 px-4 rounded-md hover:bg-pink-700 transition-colors">
                        Get Creator Info
                    </button>
                </div>
                <div id="apiResult" class="mt-4 p-3 rounded-md hidden"></div>
            </div>

            <!-- Response Log -->
            <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">üìã Response Log</h2>
                <div id="responseLog" class="bg-gray-100 p-4 rounded-md max-h-64 overflow-y-auto text-sm font-mono">
                    <div class="text-gray-500">API responses will appear here...</div>
                </div>
                <button onclick="clearLog()" 
                        class="mt-2 bg-red-600 text-white py-1 px-3 rounded-md hover:bg-red-700 transition-colors text-sm">
                    Clear Log
                </button>
            </div>
        </main>
    </div>

    <script>
        const API_BASE = 'http://localhost:3002/api/clubzila';
        
        // Utility functions
        function log(message, type = 'info') {
            const logDiv = document.getElementById('responseLog');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-600' : type === 'success' ? 'text-green-600' : 'text-blue-600';
            
            logDiv.innerHTML += `<div class="mb-1"><span class="text-gray-500">[${timestamp}]</span> <span class="${color}">${message}</span></div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function showResult(elementId, data, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.className = `mt-4 p-3 rounded-md ${isSuccess ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
            element.textContent = JSON.stringify(data, null, 2);
            element.classList.remove('hidden');
        }
        
        async function makeRequest(endpoint, data = null) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: data ? 'POST' : 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: data ? JSON.stringify(data) : null
                });
                
                const result = await response.json();
                log(`${endpoint}: ${result.status} - ${result.message}`, result.status === 'success' ? 'success' : 'error');
                return result;
            } catch (error) {
                log(`Error calling ${endpoint}: ${error.message}`, 'error');
                return { status: 'error', message: error.message };
            }
        }
        
        // Authentication functions
        async function requestOtp() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            if (!phoneNumber) {
                alert('Please enter a phone number');
                return;
            }
            
            const result = await makeRequest('/request-otp', { phone_number: phoneNumber });
            showResult('authResult', result, result.status === 'success');
        }
        
        async function authenticate() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            const otp = document.getElementById('otp').value;
            
            if (!phoneNumber) {
                alert('Please enter a phone number');
                return;
            }
            
            const data = { phone_number: phoneNumber };
            if (otp) data.otp = otp;
            
            const result = await makeRequest('/authenticate', data);
            showResult('authResult', result, result.status === 'success');
        }
        
        // Subscription functions
        async function checkSubscription() {
            const userId = document.getElementById('userId').value;
            const creatorId = document.getElementById('creatorId').value;
            
            if (!userId || !creatorId) {
                alert('Please enter both User ID and Creator ID');
                return;
            }
            
            const result = await makeRequest('/check-subscription', { user_id: userId, creator_id: creatorId });
            showResult('subResult', result, result.status === 'success');
        }
        
        async function processPayment() {
            const authId = document.getElementById('userId').value;
            const creatorId = document.getElementById('creatorId').value;
            const phoneNumber = document.getElementById('subPhoneNumber').value;
            
            if (!authId || !creatorId || !phoneNumber) {
                alert('Please enter Auth ID, Creator ID, and Phone Number');
                return;
            }
            
            const result = await makeRequest('/process-payment', { 
                auth_id: authId, 
                creator_id: creatorId, 
                phone_number: phoneNumber 
            });
            showResult('subResult', result, result.status === 'success');
        }
        
        async function handleSubscription() {
            const userId = document.getElementById('userId').value;
            const creatorId = document.getElementById('creatorId').value;
            const phoneNumber = document.getElementById('subPhoneNumber').value;
            const autoPay = document.getElementById('autoPay').checked;
            
            if (!userId || !creatorId || !phoneNumber) {
                alert('Please enter User ID, Creator ID, and Phone Number');
                return;
            }
            
            const result = await makeRequest('/handle-subscription', { 
                user_id: userId, 
                creator_id: creatorId, 
                phone_number: phoneNumber,
                auto_pay: autoPay
            });
            showResult('subResult', result, result.status === 'success');
        }
        
        // API functions
        async function testIntegration() {
            const result = await makeRequest('/test');
            showResult('apiResult', result, result.status === 'success');
        }
        
        async function getUser() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            if (!phoneNumber) {
                alert('Please enter a phone number');
                return;
            }
            
            const result = await makeRequest('/get-user', { phone_number: phoneNumber });
            showResult('apiResult', result, result.status === 'success');
        }
        
        async function getCreator() {
            const creatorId = document.getElementById('creatorId').value;
            if (!creatorId) {
                alert('Please enter a Creator ID');
                return;
            }
            
            const result = await makeRequest('/get-creator', { creator_id: creatorId });
            showResult('apiResult', result, result.status === 'success');
        }
        
        function clearLog() {
            document.getElementById('responseLog').innerHTML = '<div class="text-gray-500">API responses will appear here...</div>';
        }
        
        // Initialize
        log('Clubzila Integration Demo loaded. Server running on http://localhost:3002');
    </script>
</body>
</html>
